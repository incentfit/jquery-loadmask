/**
 * Nico Westerdale
 * http://codepen.io/galaxathon/pen/GWoGBj
 */
var loaddotstimeout, loaddotstimeoutfinal;
$.fn.mask = function (msg, percent) {
	if (msg === null || msg == 'null') msg = '';
	if (this.prop('tagName') && this.prop('tagName').toLowerCase() == 'body') {
		clearTimeout(loaddotstimeout);
		clearTimeout(loaddotstimeoutfinal);
		loaddotstimeoutfinal = setTimeout(this.children('.loaddotsback').hide.bind(this.children('.loaddotsback')), 30000);
	}
	if (this.children('.loaddotsback').length) {
		this.children('.loaddotsback').show();
	} else {
		this.append('<div class="loaddotsback"><div class="loaddots"><div><div class="loaddotspct"></div><div class="loaddotsmsg"></div><ul><li></li><li></li><li></li><li></li></ul></div></div></div>');
	}
	this.children('.loaddotsback').find('.loaddotspct').text(' ');
	this.children('.loaddotsback').find('.loaddotsmsg').text(' ');
	this.children('.loaddotsback').find('.loaddotspct').text(percent);
	this.children('.loaddotsback').find('.loaddotsmsg').text(msg);
	if (percent)
		this.children('.loaddotsback').removeClass('loaddotsclear');
	else
		this.children('.loaddotsback').addClass('loaddotsclear');
	if (msg)
		this.children('.loaddotsback').removeClass('loaddotssimple');
	else
		this.children('.loaddotsback').addClass('loaddotssimple');
};
$.fn.unmask = function (msg, percent) {
	var destroymask = function () {
		this.prevObject.children('.loaddotsback').find('.loaddotspct').text(' ');
		this.prevObject.children('.loaddotsback').find('.loaddotsmsg').text(' ');
		this.prevObject.children('.loaddotsback').hide();
	}
	if (this.prop('tagName') && this.prop('tagName').toLowerCase() == 'body') {
		clearTimeout(loaddotstimeout);
		clearTimeout(loaddotstimeoutfinal);
		loaddotstimeout = setTimeout(destroymask.bind(this.children('.loaddotsback')), 200);
	} else {
		setTimeout(destroymask.bind(this.children('.loaddotsback')), 200);
	}
};
